# nono Security Lists
#
# This file contains the security-critical blocklists for nono sandbox.
#
# POLICY REFERENCE:
# =================
# [sensitive_paths]    -> DENY content read, ALLOW metadata (stat/exists)
#                         Enforced in: src/sandbox/macos.rs, src/sandbox/linux.rs
#
# [dangerous_commands] -> BLOCK execution (command refused before running)
#                         Enforced in: src/config/mod.rs::is_command_blocked()
#
# [system_read_paths]  -> ALLOW read access (required for executables to run)
#                         Enforced in: src/sandbox/macos.rs, src/sandbox/linux.rs

[meta]
version = 1
schema_version = "0.2.0"
# updated field set during signing

[sensitive_paths]
# POLICY: DENY content read (metadata allowed)

# POLICY: DENY
# Credentials and secrets
ssh = ["~/.ssh"]
aws = ["~/.aws"]
gcp = ["~/.gcloud", "~/.config/gcloud"]
azure = ["~/.azure"]
kubernetes = ["~/.kube"]
docker = ["~/.docker"]
gnupg = ["~/.gnupg"]

# POLICY: DENY
# Password managers and keystores
keychain = ["~/Library/Keychains"]
password_store = ["~/.password-store"]
onepassword = ["~/.1password"]

# POLICY: DENY
# macOS-specific sensitive data
macos_private = [
    "~/Library/Messages",
    "~/Library/Mail",
    "~/Library/Cookies",
    "~/Library/Safari",
    "~/Library/Containers/com.apple.Safari",
    "~/Library/Application Support/MobileSync",
]

# POLICY: DENY
# Browser profiles (cookies, saved passwords, sessions)
browser_data = [
    "~/Library/Application Support/Google/Chrome",
    "~/Library/Application Support/Firefox",
    "~/Library/Application Support/Microsoft Edge",
    "~/Library/Application Support/Arc",
    "~/Library/Application Support/Brave Browser",
]

# POLICY: DENY
# Credential files
credential_files = [
    "~/.git-credentials",
    "~/.netrc",
    "~/.npmrc",
    "~/.vault-token",
]

# POLICY: DENY
# Directories that may contain secrets
secrets_dirs = [
    "~/.credentials",
    "~/.secrets",
    "~/.keys",
    "~/.pki",
    "~/.terraform.d",
]

# POLICY: DENY
# Shell configurations (often embed secrets/tokens)
shell_configs = [
    # Zsh
    "~/.zshrc",
    "~/.zprofile",
    "~/.zshenv",
    "~/.zlogin",
    "~/.zlogout",
    # Bash
    "~/.bashrc",
    "~/.bash_profile",
    "~/.bash_login",
    "~/.bash_logout",
    "~/.profile",
    # Fish
    "~/.config/fish",
    # Environment files
    "~/.env",
    "~/.envrc",
]

# POLICY: DENY
# Command history (may contain sensitive commands)
history_files = [
    "~/.bash_history",
    "~/.zsh_history",
    "~/.history",
]

[dangerous_commands]
# POLICY: BLOCK execution

# POLICY: BLOCK
# Commands blocked by default due to destructive potential
file_destruction = ["rm", "rmdir", "shred", "srm"]

# POLICY: BLOCK
disk_destruction = [
    "dd",
    "mkfs",
    "mkfs.ext4",
    "mkfs.xfs",
    "mkfs.btrfs",
    "mkswap",
    "fdisk",
    "parted",
    "gdisk",
    "wipefs",
]

# POLICY: BLOCK
permission_chaos = ["chmod", "chown", "chgrp", "chattr"]

# POLICY: BLOCK
system_modification = ["init", "shutdown", "reboot", "halt", "poweroff", "systemctl"]

# POLICY: BLOCK
package_managers = ["apt", "apt-get", "dpkg", "yum", "dnf", "pacman", "brew", "pip"]

# POLICY: BLOCK
dangerous_file_ops = ["mv", "cp", "truncate"]

# POLICY: BLOCK
network_exfiltration = ["scp", "rsync", "sftp", "ftp"]

# POLICY: BLOCK
arbitrary_execution = ["xargs"]

# POLICY: BLOCK
privilege_escalation = ["sudo", "su", "doas", "pkexec"]

[system_read_paths]
# POLICY: ALLOW read access
# System paths needed for executables to run
# Platform-specific paths are in separate sections

# POLICY: ALLOW read
# Common to both platforms
common = [
    "/bin",
    "/usr/bin",
    "/usr/local/bin",
    "/sbin",
    "/usr/sbin",
]

[system_read_paths.linux]
# POLICY: ALLOW read access
# Shared libraries (including multiarch paths for Debian/Ubuntu)
libraries = [
    "/lib",
    "/lib64",
    "/lib/x86_64-linux-gnu",
    "/lib/aarch64-linux-gnu",
    "/usr/lib",
    "/usr/lib64",
    "/usr/lib/x86_64-linux-gnu",
    "/usr/lib/aarch64-linux-gnu",
    "/usr/local/lib",
    "/usr/local/lib64",
]

# POLICY: ALLOW read
# Dynamic linker configuration
linker = [
    "/etc/ld.so.cache",
    "/etc/ld.so.conf",
    "/etc/ld.so.conf.d",
]

# POLICY: ALLOW read
# System configuration commonly needed by programs
config = [
    "/etc/passwd",
    "/etc/group",
    "/etc/nsswitch.conf",
    "/etc/resolv.conf",
    "/etc/hosts",
    "/etc/hostname",
    "/etc/machine-id",
]

# POLICY: ALLOW read
# Locale and timezone data
locale = [
    "/usr/share/locale",
    "/usr/share/locale-langpack",
    "/usr/share/zoneinfo",
    "/etc/localtime",
    "/etc/timezone",
]

# POLICY: ALLOW read
# SSL certificates
ssl = [
    "/etc/ssl",
    "/etc/pki",
    "/usr/share/ca-certificates",
]

# POLICY: ALLOW read
# Terminfo for terminal apps
terminfo = [
    "/usr/share/terminfo",
    "/lib/terminfo",
    "/etc/terminfo",
]

# POLICY: ALLOW read
# Device files - only safe, commonly needed devices
# (NOT /dev as a whole, which would expose /dev/sda, /dev/mem, etc.)
devices = [
    "/dev/null",
    "/dev/zero",
    "/dev/random",
    "/dev/urandom",
    "/dev/full",
    "/dev/tty",
    "/dev/console",
    "/dev/stdin",
    "/dev/stdout",
    "/dev/stderr",
    "/dev/fd",
    "/dev/pts",
]

# POLICY: ALLOW read
# Proc and sys filesystems
proc = [
    "/proc",
    "/sys",
    "/run",
    "/var/run",
]

# POLICY: ALLOW read
# NixOS / Nix package manager
# All Nix-managed binaries and libraries live in /nix/store
nix = [
    "/nix",
]

[system_read_paths.macos]
# POLICY: ALLOW read access (except 'writable' which is ALLOW write)
# macOS executables and libraries
executables = [
    "/System/Library",
    "/Library",
    "/usr/lib",
    "/usr/local/lib",
]

# POLICY: ALLOW read
# macOS allows broader dev access (sandboxed differently)
devices = ["/dev"]

# POLICY: ALLOW read
# Frameworks
frameworks = [
    "/System/Library/Frameworks",
    "/Library/Frameworks",
]

# POLICY: ALLOW read
# Dynamic linker cache (critical for dyld)
dyld = [
    "/private/var/db/dyld",
    "/var/db/dyld",
    "/var/db",
]

# POLICY: ALLOW read
# SSL certificates and system config
ssl = [
    "/private/etc/ssl",
    "/etc/ssl",
    "/etc",
    "/private/etc",
]

# POLICY: ALLOW read
# Locale and timezone data, plus shared data
locale = [
    "/usr/share/zoneinfo",
    "/usr/share/locale",
    "/var/db/timezone",
    "/usr/share",
]

# POLICY: ALLOW read
# Terminfo for terminal apps
terminfo = [
    "/usr/share/terminfo",
]

# POLICY: ALLOW read
# System paths and their symlink targets
# macOS uses /private for actual paths with symlinks from root
# Also need /System/Volumes for modern macOS (10.15+) which uses APFS volumes
# /tmp is a symlink to /private/tmp - need both for path resolution
system = [
    "/var",
    "/private/var",
    "/private",
    "/tmp",
    "/System/Volumes",
    "/Applications",
    "/cores",
    "/opt",
    "/Volumes",
]

# POLICY: ALLOW read
# User library paths (need ~ expansion at runtime)
# Only specific subdirectories, not all of ~/Library
user_library = [
    "~/Library/Caches",
    "~/Library/Logs",
    "~/Library/Preferences",
]

# POLICY: ALLOW read
# User-local executables and version managers
# These paths contain user-installed tools and version managers
user_local = [
    "~/.local/bin",
    "~/.local/share",
    "~/.local/state",
    "~/.cargo/bin",
    "~/.rustup",
    "~/.nvm",
    "~/.fnm",
]

# POLICY: ALLOW write access
# macOS writable system paths (needed for many tools)
writable = [
    "/private/tmp",
    "/tmp",
    "/private/var/folders",
]
