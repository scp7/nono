# nono Security Lists
#
# This file contains the security-critical blocklists for nono sandbox.

[meta]
version = 1
schema_version = "0.2.0"
# updated field set during signing

[sensitive_paths]
# Credentials and secrets
ssh = ["~/.ssh"]
aws = ["~/.aws"]
gcp = ["~/.gcloud", "~/.config/gcloud"]
azure = ["~/.azure"]
kubernetes = ["~/.kube"]
docker = ["~/.docker"]
gnupg = ["~/.gnupg"]

# Password managers and keystores
keychain = ["~/Library/Keychains"]
password_store = ["~/.password-store"]
onepassword = ["~/.1password"]

# macOS-specific sensitive data
macos_private = [
    "~/Library/Messages",
    "~/Library/Mail",
    "~/Library/Cookies",
    "~/Library/Safari",
    "~/Library/Containers/com.apple.Safari",
    "~/Library/Application Support/MobileSync",
]

# Browser profiles (cookies, saved passwords, sessions)
browser_data = [
    "~/Library/Application Support/Google/Chrome",
    "~/Library/Application Support/Firefox",
    "~/Library/Application Support/Microsoft Edge",
    "~/Library/Application Support/Arc",
    "~/Library/Application Support/Brave Browser",
]

# Credential files
credential_files = [
    "~/.git-credentials",
    "~/.netrc",
    "~/.npmrc",
    "~/.vault-token",
]

# Directories that may contain secrets
secrets_dirs = [
    "~/.credentials",
    "~/.secrets",
    "~/.keys",
    "~/.pki",
    "~/.terraform.d",
]

# Shell configurations (often embed secrets/tokens)
shell_configs = [
    # Zsh
    "~/.zshrc",
    "~/.zprofile",
    "~/.zshenv",
    "~/.zlogin",
    "~/.zlogout",
    # Bash
    "~/.bashrc",
    "~/.bash_profile",
    "~/.bash_login",
    "~/.bash_logout",
    "~/.profile",
    # Fish
    "~/.config/fish",
    # Environment files
    "~/.env",
    "~/.envrc",
]

# Command history (may contain sensitive commands)
history_files = [
    "~/.bash_history",
    "~/.zsh_history",
    "~/.history",
]

[dangerous_commands]
# Commands blocked by default due to destructive potential
file_destruction = ["rm", "rmdir", "shred", "srm"]
disk_destruction = [
    "dd",
    "mkfs",
    "mkfs.ext4",
    "mkfs.xfs",
    "mkfs.btrfs",
    "mkswap",
    "fdisk",
    "parted",
    "gdisk",
    "wipefs",
]
permission_chaos = ["chmod", "chown", "chgrp", "chattr"]
system_modification = ["init", "shutdown", "reboot", "halt", "poweroff", "systemctl"]
package_managers = ["apt", "apt-get", "dpkg", "yum", "dnf", "pacman", "brew", "pip"]
dangerous_file_ops = ["mv", "cp", "truncate"]
network_exfiltration = ["scp", "rsync", "sftp", "ftp"]
arbitrary_execution = ["xargs"]
privilege_escalation = ["sudo", "su", "doas", "pkexec"]

[system_read_paths]
# System paths needed for executables to run
# Platform-specific paths are in separate sections

# Common to both platforms
common = [
    "/bin",
    "/usr/bin",
    "/usr/local/bin",
    "/sbin",
    "/usr/sbin",
]

[system_read_paths.linux]
# Shared libraries
libraries = [
    "/lib",
    "/lib64",
    "/usr/lib",
    "/usr/lib64",
    "/usr/local/lib",
    "/usr/local/lib64",
]

# Dynamic linker configuration
linker = [
    "/etc/ld.so.cache",
    "/etc/ld.so.conf",
    "/etc/ld.so.conf.d",
]

# System configuration commonly needed by programs
config = [
    "/etc/passwd",
    "/etc/group",
    "/etc/nsswitch.conf",
    "/etc/resolv.conf",
    "/etc/hosts",
    "/etc/hostname",
    "/etc/machine-id",
]

# Locale and timezone data
locale = [
    "/usr/share/locale",
    "/usr/share/zoneinfo",
    "/etc/localtime",
    "/etc/timezone",
]

# SSL certificates
ssl = [
    "/etc/ssl",
    "/etc/pki",
    "/usr/share/ca-certificates",
]

# Terminfo for terminal apps
terminfo = [
    "/usr/share/terminfo",
    "/lib/terminfo",
    "/etc/terminfo",
]

# Device files - only safe, commonly needed devices
# (NOT /dev as a whole, which would expose /dev/sda, /dev/mem, etc.)
devices = [
    "/dev/null",
    "/dev/zero",
    "/dev/random",
    "/dev/urandom",
    "/dev/full",
    "/dev/tty",
    "/dev/console",
    "/dev/stdin",
    "/dev/stdout",
    "/dev/stderr",
    "/dev/fd",
    "/dev/pts",
]

# Proc and sys filesystems
proc = [
    "/proc",
    "/sys",
    "/run",
    "/var/run",
]

[system_read_paths.macos]
# macOS executables and libraries
executables = [
    "/System/Library",
    "/Library",
    "/usr/lib",
    "/usr/local/lib",
]

# macOS allows broader dev access (sandboxed differently)
devices = ["/dev"]

# Frameworks
frameworks = [
    "/System/Library/Frameworks",
    "/Library/Frameworks",
]

# Dynamic linker cache (critical for dyld)
dyld = [
    "/private/var/db/dyld",
    "/var/db/dyld",
    "/var/db",
]

# SSL certificates and system config
ssl = [
    "/private/etc/ssl",
    "/etc/ssl",
    "/etc",
    "/private/etc",
]

# Locale and timezone data, plus shared data
locale = [
    "/usr/share/zoneinfo",
    "/usr/share/locale",
    "/var/db/timezone",
    "/usr/share",
]

# Terminfo for terminal apps
terminfo = [
    "/usr/share/terminfo",
]

# System paths and their symlink targets
# macOS uses /private for actual paths with symlinks from root
# Also need /System/Volumes for modern macOS (10.15+) which uses APFS volumes
# /tmp is a symlink to /private/tmp - need both for path resolution
system = [
    "/var",
    "/private/var",
    "/private",
    "/tmp",
    "/System/Volumes",
    "/Applications",
    "/cores",
    "/opt",
    "/Volumes",
]

# User library paths (need ~ expansion at runtime)
# Only specific subdirectories, not all of ~/Library
user_library = [
    "~/Library/Caches",
    "~/Library/Logs",
    "~/Library/Preferences",
]

# User-local executables and version managers
# These paths contain user-installed tools and version managers
user_local = [
    "~/.local/bin",
    "~/.local/share",
    "~/.local/state",
    "~/.cargo/bin",
    "~/.rustup",
    "~/.nvm",
    "~/.fnm",
]

# macOS writable system paths (needed for many tools)
writable = [
    "/private/tmp",
    "/tmp",
    "/private/var/folders",
]
